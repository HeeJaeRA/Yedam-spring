<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.emp.mapper.EmpMapper">

	<!-- 전체 조회 -->
	<select id="selectEmpList" resultType="EmpVO">
		select employee_id,
		last_name, email, hire_date, job_id, salary
		from employees
		order by
		employee_id
	</select>

	<!-- 단건 조회 -->
	<select id="selectEmpInfo" resultType="EmpVO">
		select employee_id,
		last_name, email, hire_date, job_id, salary
		from employees
		where
		employee_id = #{employeeId}
	</select>

	<!-- 등록 -->
	<insert id="insertEmpInfo" parameterType="EmpVO">
		<!-- BEFORE로 설정하면 키를 먼저 조회하고 그 값을 keyProperty 에 셋팅한 뒤 insert 구문을 실행 AFTER로 
			설정하면 insert 구문을 실행한 뒤 selectKey 구문을 실행 
			employee_id가 seq가 아니기때문에 마지막 값 + 1 로 설정 -->
		<selectKey keyProperty="employeeId" resultType="int"
			order="BEFORE">
			select nvl(max(employee_id), 0) + 1
			from employees
		</selectKey>
		insert into employees (employee_id, last_name, email, hire_date,
		job_id, salary)
		values (#{employeeId}, #{lastName}, #{email},
		#{hireDate}, #{jobId}, #{salary})
	</insert>

	<!-- 수정 -->
	<update id="updateEmpInfo" parameterType="EmpVO">
		update employees
		set
		last_name = #{lastName}, email = #{email}, salary = #{salary}
		where
		employee_id = #{employeeId}
	</update>

	<!-- 수정 : 전송된 데이터만 변경 -->
	<update id="updateEmpInfoDynamic" parameterType="EmpVO">
		update employees
		set
		<choose>
			<when test="lastName !=null and !lastName.equals('')">
				last_name = #{lastName}
			</when>
			<otherwise>
				last_name='Any'
			</otherwise>
		</choose>

		<if test="email != null">
			, email = #{email}
		</if>
		<if test="salary >= 0">
			, salary = #{salary}
		</if>
		<!-- setEmployeeId 가 없을때는..? -->
		<where>
			<if test="employeeId > 0">
				employee_id= #{employeeId}
			</if>
		</where>
	</update>

	<!-- 수정 : 매개변수 2개인 경우 -->
	<update id="updateEmpSal">
		update employees
		set salary = salary * #{info.salary}
		where employee_id = #{eid}
	</update>

	<!-- 삭제 -->
	<delete id="deleteEmpInfo" parameterType="int">
		delete from employees
		where employee_id= #{eid}
	</delete>

</mapper>
  